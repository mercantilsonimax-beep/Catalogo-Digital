<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Catálogo Digital</title>
<style>
body { font-family: Arial; background:#f4f4f4; text-align:center; }
form { background:white; padding:20px; margin:20px auto; width:300px; border-radius:10px; }
input { width:90%; padding:8px; margin:5px; }
button { padding:8px 12px; margin:5px; cursor:pointer; }
.producto {
  background:white;
  padding:15px;
  margin:15px;
  border-radius:10px;
  display:inline-block;
  width:250px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
}
img { width:100%; height:150px; object-fit:cover; border-radius:8px; }
</style>
</head>
<body>

<h1>Mi Catálogo Digital</h1>

<form id="formulario">
  <input type="hidden" id="indice">
  <input type="text" id="codigo" placeholder="Código del producto" required>
  <input type="text" id="nombre" placeholder="Nombre" required>
  <input type="text" id="descripcion" placeholder="Descripción" required>
  <input type="text" id="categoria" placeholder="Categoría" required>
  <input type="number" id="precio" placeholder="Precio" required>
  <input type="file" id="imagen" accept="image/*" required>
  <button type="submit">Guardar Producto</button>
</form>

<div id="contenedor"><hr>

<h2>Buscar y Filtrar</h2>

<input type="text" id="buscador" placeholder="Buscar por nombre o código">
<select id="filtroCategoria">
  <option value="">Todas las categorías</option>
</select>

<br><br>

<button onclick="exportarTXT()">Exportar Base de Datos (TXT)</button>
<input type="file" id="importarArchivo" accept=".txt">
<button onclick="importarTXT()">Importar Base de Datos</button>

<hr></div>

<script>
let productos = JSON.parse(localStorage.getItem("productos")) || [];

const formulario = document.getElementById("formulario");
const contenedor = document.getElementById("contenedor");
const buscador = document.getElementById("buscador");
const filtroCategoria = document.getElementById("filtroCategoria");

function guardarLocal() {
  localStorage.setItem("productos", JSON.stringify(productos));
}

function actualizarCategorias() {
  const categoriasUnicas = [...new Set(productos.map(p => p.categoria))];
  filtroCategoria.innerHTML = '<option value="">Todas las categorías</option>';
  categoriasUnicas.forEach(cat => {
    filtroCategoria.innerHTML += `<option value="${cat}">${cat}</option>`;
  });
}

function mostrarProductos() {
  const textoBusqueda = buscador.value.toLowerCase();
  const categoriaSeleccionada = filtroCategoria.value;

  contenedor.innerHTML = "";

  productos
    .filter(p =>
      (p.nombre.toLowerCase().includes(textoBusqueda) ||
       p.codigo.toLowerCase().includes(textoBusqueda)) &&
      (categoriaSeleccionada === "" || p.categoria === categoriaSeleccionada)
    )
    .forEach((producto, index) => {
      contenedor.innerHTML += `
        <div class="producto">
          <img src="${producto.imagen}">
          <h3>${producto.nombre}</h3>
          <p><strong>Código:</strong> ${producto.codigo}</p>
          <p><strong>Categoría:</strong> ${producto.categoria}</p>
          <p>${producto.descripcion}</p>
          <p><strong>$${producto.precio}</strong></p>
          <button onclick="editar(${index})">Editar</button>
          <button onclick="eliminar(${index})">Eliminar</button>
        </div>
      `;
    });

  actualizarCategorias();
}

formulario.addEventListener("submit", function(e) {
  e.preventDefault();

  const indice = document.getElementById("indice").value;
  const fileInput = document.getElementById("imagen");
  const file = fileInput.files[0];
  const reader = new FileReader();

  reader.onload = function() {
    const producto = {
      codigo: document.getElementById("codigo").value,
      nombre: document.getElementById("nombre").value,
      descripcion: document.getElementById("descripcion").value,
      categoria: document.getElementById("categoria").value,
      precio: document.getElementById("precio").value,
      imagen: reader.result
    };

    if (indice === "") {
      productos.push(producto);
    } else {
      productos[indice] = producto;
      document.getElementById("indice").value = "";
    }

    guardarLocal();
    formulario.reset();
    mostrarProductos();
  };

  if (file) reader.readAsDataURL(file);
});

function editar(index) {
  const p = productos[index];
  document.getElementById("codigo").value = p.codigo;
  document.getElementById("nombre").value = p.nombre;
  document.getElementById("descripcion").value = p.descripcion;
  document.getElementById("categoria").value = p.categoria;
  document.getElementById("precio").value = p.precio;
  document.getElementById("indice").value = index;
}

function eliminar(index) {
  if (confirm("¿Eliminar este producto?")) {
    productos.splice(index, 1);
    guardarLocal();
    mostrarProductos();
  }
}

buscador.addEventListener("input", mostrarProductos);
filtroCategoria.addEventListener("change", mostrarProductos);

function exportarTXT() {
  const dataStr = JSON.stringify(productos);
  const blob = new Blob([dataStr], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "base_datos_productos.txt";
  a.click();
}

function importarTXT() {
  const archivo = document.getElementById("importarArchivo").files[0];
  if (!archivo) return alert("Selecciona un archivo TXT");

  const reader = new FileReader();
  reader.onload = function(e) {
    productos = JSON.parse(e.target.result);
    guardarLocal();
    mostrarProductos();
  };
  reader.readAsText(archivo);
}

mostrarProductos();
</script>

</body>
</html>
